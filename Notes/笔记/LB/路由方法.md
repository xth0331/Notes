# 路由方法



## NAT路由

下图说明了利用NAT路由在Internet和专用网络之间移动请求的负载均衡。

![](https://blog-image.nos-eastchina1.126.net/lvs-nat-routing.png)

活动的LVS路由器有连个NIC。Internet的NIC在eth0上具有*真实IP地址*和浮动IP地址。专用网络接口的NIC在eth1上具有真实IP地址和浮动IP地址。专用网络接口的NIC在eth1上具有真实IP地址和浮动IP地址。在故障转移的情况下，面向Internet的虚拟接口和面向私有的虚拟接口同时由备用LVS路由器接管。位于专用网络上的所有真实服务器都是用NAT路由的浮动IP作为与活动LVS路由器通信的默认路由，以便他们响应来自Internet的请求的能力不受损害。

LVS路由器的公共浮动IP地址和专用NAT浮动IP地址被分配给物理NIC。虽然可以将每个浮动IP地址与LVS路由器节点上的自己的物理设备相关联，不要求具有两个以上NIC。

活动LVS路由器接收请求并将其路由到适当的服务器。然后，真是服务器处理该请求并将数据包返回到LVS路由器，该路由器使用网络地址转换来用LVS路由器的公共VIP地址替换数据包中的真实服务器的地址。此过程称为IP伪装，因为真实服务器的实际IP地址对请求客户端是隐藏的。

使用此NAT路由，真实服务器可以是运行各种操作系统的任何类型的机器。主要缺点是LVS路由器可能成为大型集群的瓶颈，因为它必须处理传入和传出请求。

这些`ipvs`模块使用自己的内部NAT例程，这些例程独立于`iptables`和`ip6tables`NAT。当真实服务器配置为NAT而不是`/etc/keepalived/keepalived.conf`文件中的DR时。浙江有助于IPv4和IPv6NAT。

