# 配置大内存页

有个两种方法可以保留大内存页：

1. at **boot time**（启动时修改）
2. at **run time**（运行时修改）



在 启动时保留会增加成功的可能性，因为内存尚未明显碎片化。但是在NUMA架构上，页面数量会自动在NUMA节点之间分配。运行时修改允许为每个NUMA节点保留大内存页。如果在引导过程中今早完成运行时预留，则内存碎片的可能性会降低。



## 引导时配置大内存页

要在引导时配置大内存页，请将以下参数添加到内核引导命令行：



- `hugepages`

  定义引导时在内核中配置的持久性大内存页的数量。默认值为0，如果系统中有足够的连续物理空闲页面，则只能分配大内存页。此参数保留的页不能用于其他目的。

  通过修改`proc/sys/vm/nr_hugepages`文件的值在引导后使用。

  在NUMA系统中，使用此参数分配的大内存页在节点之间平均分配。可以通过更改节点的值在运行时将大内存页分配给特定节点的`/sys/devices/system/node/NODE_ID/hugepages/hugepages-1048576kB/nr_hugepages`文件。
