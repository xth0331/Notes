# 监控和诊断性能问题

## 使用vmstat监控内存使用量

`vmstat`由procps-ng包提供。

以下命令显示各种事件计数器和内存统计的表。

```bash
vmstat -s
```

## 使用Valgrind分析应用程序的内存使用情况

`valgrind`是一个为用户空间二进制文件提供检测的框架。附带了许多工具，用于分析程序的性能：

要使用`valgrind`请安装`balgrind`软件包：

```bash
yum install valgrind
```



### 使用memcheck分析内存使用情况

`memcheck`是默认的`valgrind`工具。可以检测并报告许多难以检测和诊断的内存错误，例如：

- 不应发生的内存访问
- 未定义或未初始化的值使用
- 错误地释放堆内存
- 指针重置
- 内存泄露



由于`memcheck`使用检测，因此使用`memcheck`执行的应用程序比平时慢十倍到三十倍。

要在应用程序运行`memcheck`，执行以下命令:

```bash
valgrind --tool=mecheck APPLICATION
```

还可以使用以下选项将`memcheck`输出集中在特定类型的问题上。

- `--leak-check`

  应用程序完成启动后，`memcheck`会搜索内存泄露。默认值为`--leak-check=summary`.它打印出发现的内存泄露次数，可以指定`--leak-check=yes`或`--leak-check=full`来输出每个泄露的详细信息。要禁用，请指定`--leak-check=no`。

- `--undef-value-errors`

  默认值为`--undef-value-errors=yes`,当未使用自定义的值时报告错误，还可以指定`--undef-value-error=no`，这将禁用此报告，加快`memcheck`。

- `--ignore-ranges`

  指定`memcheck`在检查内存寻址能力时忽略一个或多个范围，例如，`--ignore-ranges=0xPP-0xQQ,0xRR-0xSS`。




