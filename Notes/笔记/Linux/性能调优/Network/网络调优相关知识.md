# 网络调优相关知识

Linux系统的数据包是由NIC（网卡）接受，并放置在内部硬件缓冲区中。然后，NIC发送硬件中断请求，提示创建软中断操作以处理中断请求。

作为软中断操作的一部分，数据包从缓冲区传输到网络堆栈。根据数据包和网络配置，数据包随后被转发，丢弃或传递到应用程序的套接字接手队列，然后从网络堆栈中删除。此过程将继续，知道NIC硬件缓冲区中没有剩余数据包，或者传输一定数量的数据包（`/proc/sys/net/core/dev_weight`中指定）。

> 网络性能问题通常是硬件故障或基础设施故障的结果，建议调整网络堆栈之前验证硬件和基础架构是否按预期工作。



## 数据包接收的瓶颈

虽然网络堆栈在很大程度上自我优化。但是网络数据包处理过程中存在许多可能称为瓶颈并且降低性能的问题。

- **NIC硬件缓冲区或循环缓冲区**

  如果大量丢包，硬件缓冲区可能成为瓶颈。可以使用`ethtools`查看丢包信息。

- **硬中断或软中断队列**

  中断可能会增加延迟和处理器争用。

- **应用程序的套接字接收队列**

  应用程序接收队列中的瓶颈由大量未复制到请求应用程序的数据包指示，或者由UDP输入错误（InErrors）的增加。