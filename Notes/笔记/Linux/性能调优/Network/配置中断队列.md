# 配置中断队列

如果分析显示高延迟，则系统可能会受益于基于轮询而非基于中断的数据包接收。

## 配置繁忙轮询

繁忙轮询通过允许套接字层代码轮询网络设备的接收队列并禁用网络中断，有助于减少网络接收路径中的延迟。这消除了由中断和由此产生的上下文切换引起的延迟。但也会增加CPU利用率。繁忙的轮询还可以防止CPU休眠，从而导致额外的功耗。

默认情况下禁用繁忙轮询。要在特定套接字上启用繁忙轮询，执行：

- 将`sysctl.net.core.busy_poll`设置为除0以外的值，此参数控制等待套接字轮询和选择的碎裂上的数据包微秒数。建议设置为50。
- 将`SO_BUSY_POLL`调节自选项添加到套接字。



要全局启用繁忙轮询，必须将`sysctl.net.core.busy_read`设置为0以外的值。此参数控制在设备队列上等待套接字读取的数据包的微秒数。它还设置`SO_BUSY_POLL`选项的默认值。对于少量套接字，建议值为50，对于大量套接字，建议为100。对于极大量的套接字（超过几百个），使用`epool`。



以下驱动程序支持繁忙的轮询行为。

- bnx2x
- be2net
- ixgbe
- mlx4
- myri10ge

还可以运行以下命令来检查特定设备是否支持繁忙轮询。

```bash
ethtool -k DEVICE | grep "busy-poll"
```

如果返回`busy-poll: on[fixed]`，则设备上可以进行忙轮询。

