# Kubernetes之Pod

## Pod概览

### 认识Pods

`pod`是Kubernetes的基本构建单元——是创建或部署Kubernetes对象模型中最小最简单的单元。一个`pod`表示集群上正在运行的进程。

一个`pod`包含一个应用容器（或者，在某些情况下，是多个容器）， 存储资源，一个独立网络IP，以及控制容器运行方式的选项。一个`pod`表示`deployment`单元：Kubernetes中的单个应用程序实例，可能由单个容器或少量紧耦合并共享资源的容器组成。

Docker是Kubernetes Pod中最常用的容器运行时，但Pod也支持其他容器运行时。

Kubernetes及群众Pod可以以两种主要方式使用：

- **运行单个容器Pod**

  *one-container-per-Pod*模型是最常见的；在这种情况下，可以将Pod视为单个容器的包装，而Kubernetes直接管理Pod而不是容器本身。

- **运行多个需要协同工作的容器的Pod**

  Pod可以封装由多个协同工作的容器组成的应用程序，这些容器紧密耦合并且需要共享资源。这些共处一地的容器可能形成一个统一的服务单元-一个容器从共享卷想公众提供文件，而一个单独的`sidecar`容器刷新或更新这些文件。Pod将这些容器和存储资源作为单个可管理实体包装在一起。

  

每个Pod都用于运行给定应用程序的单个实例。如果要水平拓展应用程序（例如，运行多个实例），则应使用多个Pod，每个实例一个。在Kubernetes中，这通常被称为*replication*。复制Pod通常由称为`controller`的抽象创建和管理。

#### Pod如何管理多个容器

Pod旨在支持多个写作流程（作为容器），形成一个有凝聚力的服务单元。Pod中的容器自动位于及群众的同一物理或虚拟机上，并共同调度。容器可以共享资源和依赖关系，彼此通信，并协调它们何时以及如何终止。

 请注意，在单个Pod中对过个共存和共同管理的容器进行分组时一个相对高级的用例。直营在容器紧密耦合的特定情况下使用此模式。例如，可能有一个容器充当共享卷中文件的web服务器，以及一个单独的`sidecar`容器，用于远程源更新这些文件。如图所示：

![Pod](https://blog-image.nos-eastchina1.126.net/pod1.jpg)



Pod为期组成容器提供两种共享资源：网络和存储。

- 网络

  每个Pod都分配唯一的IP地址。Pod中的每个容器都共享网络namespace，包括IP地址和网络端口。Pod中的容器可以使用`localhost`相互通信。当Pod中的容器与Pod外部的实体通信时，必须协调它们图和使用共享网络资源（例如端口）。

- 存储

  Pod可以指定一组共享存储卷。Pod中的所有容器都可以访问共享卷，允许这些容器共享数据。如果需要重新启动其中一个容器，则卷还允许Pod中的持久数据存活。



### 使用Pod

很少直接在Kubernetes创建单独的Pod。这是因为Pod被设计为相对短暂的一次性实体。当创建Pod（直接创建或由Controller间接创建）时，它将被安排在集群中的节点上运行。Pod保留在该节点上，知道进程终止，Pod对象将被删除，Pod因资源不足而被驱逐，或者Node失败。

> 不应重启Pod，Pod中的容器。Pod本身不会运行，但是容器运行的环境会持续存在，知道删除为止。

Pod本身不能自我修复。如果将Pod调度到失败的节点，则删除Pod；同样，由于缺乏资源或节点维护，Pod无法在驱逐中存活。Kubernetes使用更高级别的抽象，称为`Controller`，它处理管理相对可处理的Pod实例的工作。