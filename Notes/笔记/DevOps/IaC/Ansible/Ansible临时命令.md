# Ansible临时命令

Ansible ad-hoc命令使用`/usr/bin/ansible`命令行工具来自动化一个或多个受管节点上的单个任务。临时命令既快速有简单，但不可重复使用。为什么首先要了解临时命令，临时命令展示了Ansible的简单性和强大功能。在此处学习的概念将直接移植到playbook。



## 为什么要使用临时命令？

临时命令非常适合很少重复性的任务。例如，如果想要在圣诞节假期关闭实验室中的所有机器的电源，则可以在Ansible中执行快速的一次工作而不需编写剧本。临时命令如下所示：

```bash
ansible [pattern] -m [module] -a "[module opetions]"
```

## 临时任务用例

临时任务可用于重新引导服务器,复制文件,管理程序包和用户等。可以在临时任务中使用任何Ansible模块。临时任务使用声明性模型，计算并执行达到指定最终状态所需的操作。通过在开始之前检查当前状态并且不执行任何操作，除非当前状态与指定的最终状态不同，它们可以实现幂等形式。

### 重新启动服务器

`ansible`命令实用程序的默认模块是`command module`。可以使用临时任务来调用`command`模块,然后依次重启所有Web服务器.每次十个。在Ansible执行此操作前，必须在清单中一个名为`[atlanta]`的组中列出所有服务器,并且该组中的媚态计算机都必须具有有效的SSH凭据。要重新启动组中的所有服务器:

```baah
ansible atlanta -a "/sbin/reboot"
```

默认情况下,Ansible仅使用5个并发进程.如果拥有主机数量超过为派生计数设置的值,会花费一些时间。要使用10个并发分支重新启动[atlanta]服务器组,请执行以下操作:

```bash
ansible atlanta -a "/sbin/reboot" -f 10 
```

`/usr/bin/ansible`将默认从您的用户账户运行.要以其他我身份连接:

```bash
ansible atlanta -a "/sbin/reboot" -f 10 -u username
```

重新引导可能需要特权升级.可以使用以下关键字变为用户身份连接到服务器,并使用`become`关键字作为`root`用户运行该命令。



