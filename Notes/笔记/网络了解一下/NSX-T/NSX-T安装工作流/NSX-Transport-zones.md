# NSX-T 传输区域

##  创建传输区域

传输区域确定哪些主机可以参与使用特定网络，进而确定哪些虚拟机可以参与使用该网络。传输区域限制可以“看到”某个逻辑交换机的主机（从而限制可以连接到该逻辑交换机的虚拟机）以实现该目的。传输区域可以跨一个或多个主机集群。

根据要求，NSX-T环境可能包含一个或多个传输区域。一个主机可以属于多个传输区域，一个逻辑交换机只能属于一个传输区域。

NSX-T不允许连接位于第二层网络中的不同传输区域的虚拟机。逻辑交换机的跨度仅限于一个传输区域，因此不同传输区域仲的虚拟机不能位于同一第二层网络。

主机传输节点和NSX Edge均使用覆盖网络传输区域。在将主机或NSX Edge传输节点添加到覆盖网络传输区域时，将在主机或NSX Edge上安装N-VDS。

NSX Edge 和传输节点将VLAN传输区域用于其VLAN上行链路。在将NSX Edge添加到VLAN传输区域时，将在NSX Edge上安装VLAN N-VDS。

N-VDS将逻辑路由器上行链路和下行链路绑定到物理网卡以支持虚拟机到物理数据包流量。

在创建传输区域时，必须提供N-VDS名称，以后在该传输区域中添加传输节点时，将在这些节点上安装N-VDS。N-VDS名称可以是所需的任意名称。

**过程**

1. 管理员权限登录`https://<nsx-manager-ip-address>`中的NSX Manager。

2. 选择**系统**>**Fabric**>**传输区域**>**添加**。

3. 输入传输区域的名称和描述。

4. 输入N-VDS名称。

5. 选择N-VDS模式。

   - 适用于所有受支持的**标准**模式。
   - **增强型数据路径**是仅适用于传输区域中可属于ESXi主机版本6.7和更高版本类型的传输节点的网络连接堆栈模式。

6. 如果N-VDS模式设置为**标准**，则选择流量类型。

   选项有**覆盖网络**和**VLAN**。

7. 如果N-VDS模式设置为**增强型数据路径，则选择流量类型。

   选项有**覆盖网络**和**VLAN**。

   > 增强型数据路径模式下，仅支持特定的网卡配置。请确保配置支持的网卡。

8. 输入一个或多个上行链路绑定策略名称。这些命名绑定策略可供连接到传输区域的逻辑交换机使用。如果逻辑交换机未找到匹配的命名绑定策略，则使用默认的上行链路绑定策略。

9. 在**传输区域**页面上查看新传输区域。

10. 还可以使用 GET https://<nsx-mgr>/api/v1/transport-zones API 调用查看新传输区域。

## 创建IP池以分配隧道端点IP地址

可以使用IP池以分配隧道端点地址。隧道端点是在外部IP头中使用的源和目的IP地址，以便标识发出和结束NSX-T覆盖网络帧封装的管理程序主机。还可以使用DHCP或手动配置的IP池以分配隧道端点IP地址。

如果同时使用ESXi和KVM主机，一种设计方法可能是将两个不同的子网用于ESXi隧道端点IP池（sub_a）和KVM隧道端点IP池（sub_b）。在这种情况下，必须在KVM主机上添加具有专用默认网关的sub_a静态路由。

在Ubuntu主机上生成的路由表示例，其中`sub_a = 192.168.140.0`，`sub_b = 192.168.150.0`。（例如，管理子网可能是192.168.130.0）。

路由表:

```bash
Destination          Gateway          Genmask          Iface
0.0.0.0              192.168.130.1    0.0.0.0          eth0
192.168.122.0        0.0.0.0          255.255.255.0    virbr0
192.168.130.0        0.0.0.0          255.255.255.0    eth0
192.168.140.0        192.168.150.1    255.255.255.0    nsx-vtep0.0
192.168.150.0        0.0.0.0          255.255.255.0    nsx-vtep0.0
```

可以使用至少两种不同的方法添加路由。在这两种方法中，仅当通过编辑接口添加路由时才能在主机重新引导后保持该路由。使用`route add`命令添加路由在主机重启后不会保留。

```bash
route add -net 192.168.140.0 netmask 255.255.255.0 gw 192.168.150.1 dev nsx-vtep0.0
```

在`/etc/network/interfaces`中的`up ifconfig nsx-vtep0.0 up`前面添加以下静态路由：

```bash
post-up route add -net 192.168.140.0 netmask 255.255.255.0 gw 192.168.150.1
```

**过程：**

1. 浏览器登录NSX Manager。
2. 选择**高级网络和安全**>**清单**>**组**>**IP池**>**添加**。
3. 输入IP池详细信息。

**结果：**

IPv4或IPv6地址池将在IP池页面上列出。

